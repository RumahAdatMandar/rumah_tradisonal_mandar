<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Virtual Tour: Rumah Boyang Mandar</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.js"></script>
    <style>
      :root {
        --bg-dark: #0f172a;
        --panel-dark: #1e293b;
        --border-dark: #334155;
        --text-light: #e2e8f0;
        --text-muted: #94a3b8;
        --accent-cyan: #22d3ee;
      }
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Helvetica, Arial, sans-serif;
        margin: 0;
        color: var(--text-light);
        background-color: var(--bg-dark);
      }
      .app {
        display: flex;
        height: 100vh;
      }
      #sidebar {
        width: 320px;
        flex-shrink: 0;
        background-color: var(--panel-dark);
        padding: 20px;
        border-right: 1px solid var(--border-dark);
        overflow-y: auto;
        display: flex;
        flex-direction: column;
      }
      #sidebar h1 {
        font-size: 1.6em;
        margin-top: 0;
        color: white;
      }
      #sidebar .meta {
        font-size: 0.9em;
        color: var(--text-muted);
        border-bottom: 1px solid var(--border-dark);
        padding-bottom: 15px;
        margin-bottom: 15px;
      }
      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(45px, 1fr));
        gap: 10px;
        margin-bottom: 20px;
      }
      .scene-btn {
        padding: 10px;
        border: 1px solid var(--border-dark);
        background-color: var(--bg-dark);
        color: var(--text-light);
        cursor: pointer;
        border-radius: 8px;
        transition: all 0.2s ease-in-out;
        font-weight: bold;
      }
      .scene-btn:hover {
        transform: translateY(-2px);
        border-color: var(--accent-cyan);
        color: white;
      }
      .scene-btn.active {
        background-color: var(--accent-cyan);
        color: var(--bg-dark);
        border-color: var(--accent-cyan);
        box-shadow: 0 0 10px rgba(34, 211, 238, 0.5);
      }
      .controls {
        margin-top: 20px; /* ✅ SOLUSI: Mengganti 'auto' dengan nilai spesifik */
        padding-top: 15px;
        border-top: 1px solid var(--border-dark);
        display: flex;
        justify-content: space-between;
      }
      .controls button {
        width: 48%;
        padding: 12px;
        border: 1px solid var(--border-dark);
        background-color: transparent;
        color: var(--text-light);
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
        transition: all 0.2s ease;
      }
      .controls button:hover {
        background-color: var(--accent-cyan);
        color: var(--bg-dark);
        border-color: var(--accent-cyan);
      }
      #panorama {
        flex-grow: 1;
      }
      .top-buttons {
        position: fixed;
        top: 10px;
        right: 10px;
        z-index: 1000;
        display: flex;
        gap: 10px;
      }
      .back-home,
      .minimap-btn {
        background-color: var(--panel-dark);
        color: var(--text-light);
        border: 1px solid var(--border-dark);
        padding: 12px 22px;
        border-radius: 8px;
        cursor: pointer;
        text-decoration: none;
        font-family: "Poppins", sans-serif;
        font-size: 16px;
        font-weight: bold;
        transition: all 0.2s ease;
      }
      .back-home:hover,
      .minimap-btn:hover {
        background-color: var(--accent-cyan);
        color: var(--bg-dark);
        border-color: var(--accent-cyan);
      }
      .minimap-modal {
        display: none;
        position: fixed;
        z-index: 2000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
        justify-content: center;
        align-items: center;
        cursor: pointer;
      }
      .minimap-modal.active {
        display: flex;
      }
      .minimap-img {
        max-width: 90%;
        max-height: 90%;
        border: 3px solid white;
      }

      @media (max-width: 768px) {
        .app {
          flex-direction: column;
          height: auto;
        }
        #sidebar {
          width: 100%;
          margin-top: 60px;
          border-right: none;
          border-bottom: 1px solid var(--border-dark);
          box-sizing: border-box;
        }
        #panorama {
          width: 100%;
          height: 60vh;
        }
        .top-buttons {
          position: absolute;
          width: calc(100% - 20px);
          box-sizing: border-box;
        }
      }
    </style>
  </head>
  <body>
    <div class="top-buttons">
      <a href="index.html" class="back-home">Kembali ke Beranda</a>
      <button class="minimap-btn" onclick="showMinimap()">
        Tampilkan Minimap
      </button>
      <button id="toggleDragBtn" class="minimap-btn">Nonaktifkan Drag</button>
    </div>

    <div id="minimapModal" class="minimap-modal" onclick="hideMinimap()">
      <img
        src="images/minimap.jpg"
        alt="Minimap Virtual Tour"
        class="minimap-img"
      />
    </div>

    <div class="app">
      <aside id="sidebar">
        <h1>Virtual Tour: Rumah Adat Mandar</h1>
        <p class="meta">
          Jelajahi setiap sudut Rumah Adat Mandar (Boyang).<br />
          Klik pada salah satu titik di bawah untuk langsung menuju lokasi.
        </p>
        <div id="sceneGrid" class="grid"></div>
        <div class="controls">
          <button id="prevBtn" title="Scene sebelumnya">◀ Sebelumnya</button>
          <button id="nextBtn" title="Scene berikutnya">Berikutnya ▶</button>
        </div>
      </aside>
      <main id="panorama"></main>
    </div>

    <script>
      // === KONFIGURASI VIRTUAL TOUR (VERSI SEDERHANA) ===
      const tourData = [
        { title: "Halaman Depan", next: { yaw: -147, pitch: 3 } },
        {
          title: "Naik Tangga",
          next: { yaw: 3, pitch: 6.3 },
          prev: { yaw: -180, pitch: -44 },
        },
        {
          title: "Ruangan Utama 1",
          next: { yaw: -104, pitch: -1 },
          prev: { yaw: 65, pitch: -1.991 },
        },
        {
          title: "Ruangan Utama 2",
          next: { yaw: -140, pitch: 4 },
          prev: { yaw: 100, pitch: 0 },
        },
        {
          title: "Teras 1",
          next: { yaw: -5, pitch: -18 },
          prev: { yaw: -128, pitch: -8 },
        },
        {
          title: "Teras 2",
          next: { yaw: 146, pitch: -1 },
          prev: { yaw: 173, pitch: -1 },
        },
        {
          title: "Penghubung (Dapur)",
          next: { yaw: 175, pitch: -2 },
          prev: { yaw: 15, pitch: -4 },
        },
        {
          title: "Dapur",
          next: { yaw: -147, pitch: 0 },
          prev: { yaw: -98, pitch: -5 },
        },
        {
          title: "Tangga Belakang",
          next: { yaw: -161, pitch: -1 },
          prev: { yaw: 2, pitch: 21 },
        },
        { title: "Naong Boyang", prev: { yaw: 180, pitch: 0 } },
      ];

      const config = {
        default: {
          firstScene: "scene-0",
          autoLoad: true,
          showControls: true,
          compass: false,
          hfov: 110,
          keyboardZoom: true,
          hotSpotDebug: true,
        },
        scenes: {},
      };
      tourData.forEach((sceneData, i) => {
        const sceneId = `scene-${i}`;
        config.scenes[sceneId] = {
          title: sceneData.title,
          type: "equirectangular",
          panorama: `panos/image${i}.jpg`,
          hotSpots: [],
        };

        if (i < tourData.length - 1) {
          config.scenes[sceneId].hotSpots.push({
            yaw: sceneData.next?.yaw || 0,
            pitch: sceneData.next?.pitch || 0,
            type: "scene",
            text: `Menuju: ${tourData[i + 1].title}`,
            sceneId: `scene-${i + 1}`,
          });
        }
        if (i > 0) {
          config.scenes[sceneId].hotSpots.push({
            yaw: sceneData.prev?.yaw || 180,
            pitch: sceneData.prev?.pitch || 0,
            type: "scene",
            text: `Kembali ke: ${tourData[i - 1].title}`,
            sceneId: `scene-${i - 1}`,
          });
        }
      });

      const viewer = pannellum.viewer("panorama", config);
      const minimapModal = document.getElementById("minimapModal");
      const panoramaEl = document.getElementById("panorama");
      const toggleBtn = document.getElementById("toggleDragBtn");
      const grid = document.getElementById("sceneGrid");
      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");

      const showMinimap = () => minimapModal.classList.add("active");
      const hideMinimap = () => minimapModal.classList.remove("active");
      const setActiveSceneButton = () => {
        const currentSceneId = viewer.getScene();
        document.querySelectorAll(".scene-btn").forEach((btn) => {
          btn.classList.toggle("active", btn.dataset.scene === currentSceneId);
        });
      };

      // Buat tombol scene
      tourData.forEach((scene, i) => {
        const sceneId = `scene-${i}`;
        const btn = document.createElement("button");
        btn.className = "scene-btn";
        btn.textContent = i;
        btn.dataset.scene = sceneId;
        btn.onclick = () => viewer.loadScene(sceneId);
        grid.appendChild(btn);
      });

      // Event listener untuk tombol navigasi
      const getSceneIndex = (sceneId) => parseInt(sceneId.split("-")[1], 10);

      prevBtn.onclick = () => {
        const currentIndex = getSceneIndex(viewer.getScene());
        if (currentIndex > 0) viewer.loadScene(`scene-${currentIndex - 1}`);
      };

      nextBtn.onclick = () => {
        const currentIndex = getSceneIndex(viewer.getScene());
        if (currentIndex < tourData.length - 1)
          viewer.loadScene(`scene-${currentIndex + 1}`);
      };

      viewer.on("load", setActiveSceneButton);
      setActiveSceneButton(); // Set tombol aktif saat pertama kali dimuat

      // === KODE UNTUK FITUR KOORDINAT & DRAG (TIDAK DIUBAH) ===
      const coordDiv = document.createElement("div");
      Object.assign(coordDiv.style, {
        position: "fixed",
        bottom: "24px",
        right: "24px",
        background: "var(--panel-dark)",
        color: "var(--accent-cyan)",
        padding: "10px 18px",
        borderRadius: "8px",
        fontWeight: "bold",
        zIndex: "2000",
        fontFamily: "monospace",
        pointerEvents: "none",
        border: "1px solid var(--border-dark)",
      });
      document.body.appendChild(coordDiv);

      const viewerContainer = viewer.getContainer();
      let dragEnabled = true;

      const setCoordHint = (message) => {
        coordDiv.textContent = message;
      };
      const showCoords = (event) => {
        const coords = viewer.mouseEventToCoords(event);
        coordDiv.textContent = `Yaw: ${coords[1].toFixed(
          2
        )}, Pitch: ${coords[0].toFixed(2)}`;
      };

      const handlePointer = (event) => {
        if (!dragEnabled) {
          showCoords(event);
          event.stopPropagation();
          event.preventDefault();
        }
      };

      const handleScroll = (event) => {
        if (!dragEnabled) {
          event.stopPropagation();
          event.preventDefault();
        }
      };

      const wheelListenerOptions = { capture: true, passive: false };

      function updateDragState(enable) {
        dragEnabled = enable;
        const cursor = enable ? "grab" : "pointer";
        const eventAction = enable ? "removeEventListener" : "addEventListener";

        panoramaEl.style.cursor = cursor;
        viewerContainer.style.cursor = cursor;

        viewerContainer[eventAction]("mousedown", handlePointer, true);
        viewerContainer[eventAction]("touchstart", handlePointer, true);
        viewerContainer[eventAction](
          "wheel",
          handleScroll,
          wheelListenerOptions
        );

        toggleBtn.textContent = enable ? "Nonaktifkan Drag" : "Aktifkan Drag";
        setCoordHint(
          enable ? "Klik panorama untuk koordinat" : "Mode koordinat aktif"
        );
      }

      toggleBtn.onclick = () => updateDragState(!dragEnabled);
      updateDragState(true); // Aktifkan drag saat awal
    </script>
  </body>
</html>
